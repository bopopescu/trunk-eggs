## Script (Python) "get_contacts"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=country, position, lang='en'
##title=
##
SQL = """SELECT T_CONTACT.CONAME, T_CONTACT.COFIRSTNAME, T_ORGA.ORNAME, 
T_CONTACT.COPHONEOFF, T_CONTACT.COFAXOFF, T_CONTACT.COEMAILOFF, T_EMPOS.EMPLIEN
FROM T_CONTACT
INNER JOIN T_ORGA ON (T_CONTACT.COORCODE = T_ORGA.ORCODE)
INNER JOIN T_COEMPOS ON (T_CONTACT.COCODE = T_COEMPOS.COCODE)
INNER JOIN T_EMPOS ON (T_EMPOS.EMPCODE = T_COEMPOS.EMPCODE)
INNER JOIN T_COUNTRY ON (T_CONTACT.CONFP = T_COUNTRY.CNCODE)
WHERE T_COEMPOS.EMPCODE = %s  AND (T_COUNTRY.CNNAMEEN = '%s') """ % (position, country)

SQL_fr = """SELECT T_CONTACT.CONAME, T_CONTACT.COFIRSTNAME, T_ORGA.ORNAME, 
T_CONTACT.COPHONEOFF, T_CONTACT.COFAXOFF, T_CONTACT.COEMAILOFF, T_EMPOS.EMPLIFR
FROM T_CONTACT
INNER JOIN T_ORGA ON (T_CONTACT.COORCODE = T_ORGA.ORCODE)
INNER JOIN T_COEMPOS ON (T_CONTACT.COCODE = T_COEMPOS.COCODE)
INNER JOIN T_EMPOS ON (T_EMPOS.EMPCODE = T_COEMPOS.EMPCODE)
INNER JOIN T_COUNTRY ON (T_CONTACT.CONFP = T_COUNTRY.CNCODE)
WHERE T_COEMPOS.EMPCODE = %s  AND (T_COUNTRY.CNNAMEFR = '%s') """ % (position, country)

if lang=='fr': SQL = SQL_fr
try:
    return container.execute(SQL)
except:
    return None

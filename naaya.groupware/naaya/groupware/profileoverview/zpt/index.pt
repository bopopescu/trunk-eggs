<metal:block use-macro="here/gw_macro/macros/main">
<div id="workarea" metal:fill-slot="div-workarea">

    <!-- TODO: create and fill a slot in head macro in gw_macro template -->
    <link href="++resource++naaya.groupware.profileoverview/style.css"
          rel="stylesheet" type="text/css" />
    <script src="++resource++naaya.groupware/jquery-1.4.4.min.js"
          type="text/javascript" language="javascript"></script>
    <script src="++resource++naaya.groupware/jquery-ui.custom.min.js"
          type="text/javascript" language="javascript"></script>
    <script src="++resource++naaya.groupware.profileoverview/primary.js"
          type="text/javascript" language="javascript"></script>

    <h1>Overview on memberships in interest groups,
 Roles and Subscriptions for user <tt tal:content="options/user_id" /></h1>

    <h2>Interest group membership</h2>
    <input type="hidden" id="user" tal:attributes="value options/user_id" />
    <p>
        Local roles are explicitly assigned by Administrators, while other
        access rights are inherited from a group.
    </p>
    <div id="ig_access">
        <div style='text-align: center;'>
            <img src="++resource++naaya.groupware/ajax-loader.gif" />
        </div>
    </div>

    <h2>Member of Roles</h2>
    <tal:block condition="options/roles">

    <table class="account-datatable sub-roles">
        <thead>
            <tr>
                <td>
                    Role ID
                </td>
    
                <td>
                    Role name
                </td>
            </tr>
        </thead>
    
        <tbody>
            <tal:block repeat="role options/roles">
                <tr 
                    tal:attributes="class python:('even', 'odd')[int(path('repeat/role/odd'))]+' '+role['parent'];
                                    id string:row_${role/id}">
                    <td nowrap="nowrap">
                        <div class="arrow toggle_role" tal:condition="role/children"></div>
                        <div class="arrow_placeholder" tal:condition="not: role/children"></div>
                        <a tal:attributes="id role/id" class="toggle_role"
                            tal:content="role/id"></a>
                    </td>
                    <td>
                        <span tal:content="role/description"></span>
                    </td>
                </tr>
            </tal:block>
        </tbody>
    </table>
    </tal:block>
    <tal:block condition="not: options/roles">
        <tt tal:content="options/user_id" /> does not belong to any LDAP Roles.
    </tal:block>

    <h2>Subscriptions to interest group notifications</h2>
    <div id="id_subscriptions"  tal:condition="python:len(options['subscriptions'])">
    <tal:block repeat="ig python:options['sorted_func'](options['subscriptions'].keys(), key=lambda x: x.title_or_id())">
        <tal:block define="sub_list python:options['subscriptions'][ig]">
            <div tal:attributes="id string:subscriptions_${ig/id}">
                <dl>
                    <dt tal:content="ig/title_or_id"></dt>
                    <dd>
                    <ul>
                        <li tal:repeat="sub sub_list">
                            <a tal:content="sub/object/title_or_id"
                               tal:attributes="href sub/object/absolute_url; class string:external-link; target string:_blank">
                            </a>

                            <div tal:content="sub/notif_type"
                                  tal:attributes="class string:notif_type_label ${sub/notif_type}"></div>
                        </li>
                    </ul>
                    </dd>
            </div>
        </tal:block>
    </tal:block>
    </div>
    <div id="id_subscriptions"  tal:condition="python:not len(options['subscriptions'])">
        <tt tal:content="options/user_id" /> has no subscriptions configured in Interest Groups.
    </div>

</div>
</metal:block>

